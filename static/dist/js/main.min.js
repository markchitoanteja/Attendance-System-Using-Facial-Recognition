jQuery(document).ready(function(){var e=!1;if(notification){let t=notification.split("|");Swal.fire({title:t[0],text:t[1],icon:t[2]})}$("[data-mask]").inputmask(),$("#example").DataTable({paging:!0,lengthChange:!1,ordering:!1}),$(".logout").click(function(){$.ajax({url:"/logout",type:"POST",dataType:"JSON",processData:!1,contentType:!1,success:function(e){e&&(location.href="/")},error:function(e,e,t){console.error(t)}})}),$("#mode").click(function(){let e="light";e=mode&&"dark"==mode?"light":"dark";var t=new FormData;t.append("mode",e),$.ajax({url:"/change_mode",data:t,type:"POST",dataType:"JSON",processData:!1,contentType:!1,success:function(e){e&&location.reload()},error:function(e,e,t){console.error(t)}})}),$("#account_settings_image").change(function(e){var t=$("#account_settings_image_display"),a=e.target.files[0],n=URL.createObjectURL(a);t.attr("src",n),t.on("load",function(){URL.revokeObjectURL(n)})}),$("#account_settings").click(function(){$(".loading").removeClass("d-none"),$("#account_settings_modal").modal("show");var e=new FormData;e.append("user_id",user_id),$.ajax({url:"/get_admin_data",data:e,type:"POST",dataType:"JSON",processData:!1,contentType:!1,success:function(e){e&&($("#account_settings_name").val(e.name),$("#account_settings_username").val(e.username),$("#account_settings_image_display").attr("src","static/dist/img/uploads/admin/"+e.image),$("#account_settings_old_password").val(e.password),$("#account_settings_old_image").val(e.image),$(".loading").addClass("d-none"))},error:function(e,e,t){console.error(t)}})}),$("#account_settings_form").submit(function(){let e=$("#account_settings_name").val(),t=$("#account_settings_username").val(),a=$("#account_settings_password").val(),n=$("#account_settings_confirm_password").val(),s=$("#account_settings_old_password").val(),d=$("#account_settings_image")[0],r=$("#account_settings_old_image").val(),u=0;if(d.files.length>0){var i=d.files[0];r=i.name}if(a!=n&&($("#account_settings_password").addClass("is-invalid"),$("#account_settings_confirm_password").addClass("is-invalid"),$("#error_account_settings_password").removeClass("d-none"),u++),!u){$("#account_settings_submit").text("Please wait..."),$("#account_settings_submit").attr("disabled",!0),$(".loading").removeClass("d-none");let o=!0;a||(a=s,o=!1);var l=new FormData;l.append("user_id",user_id),l.append("name",e),l.append("username",t),l.append("password",a),l.append("is_new_password",o),l.append("image",r),l.append("image_file",i),$.ajax({url:"/update_admin",data:l,type:"POST",dataType:"JSON",processData:!1,contentType:!1,success:function(e){e&&setTimeout(function(){location.reload()},1500)},error:function(e,e,t){console.error(t)}})}}),$("#account_settings_password").keydown(function(){$("#account_settings_password").removeClass("is-invalid"),$("#account_settings_confirm_password").removeClass("is-invalid"),$("#error_account_settings_password").addClass("d-none")}),$("#account_settings_confirm_password").keydown(function(){$("#account_settings_password").removeClass("is-invalid"),$("#account_settings_confirm_password").removeClass("is-invalid"),$("#error_account_settings_password").addClass("d-none")}),$("#new_student").click(function(){$("#new_student_modal").modal("show")}),$("#camera_start_stop").click(function(){e?(Webcam.reset(),$("#camera_preview").html(""),$(this).text("Start Camera"),$(this).removeClass("btn-danger"),$(this).addClass("btn-primary"),$("#capture_image").attr("disabled",!0),$("#capture_image").text("Capture"),e=!1):(Webcam.set({height:250,image_format:"jpeg",jpeg_quality:90}),Webcam.attach("#camera_preview"),$(this).text("Stop Camera"),$(this).removeClass("btn-primary"),$(this).addClass("btn-danger"),$("#capture_image").removeAttr("disabled"),e=!0)}),$("#capture_image").click(function(){Webcam.snap(function(e){$("#captured_image_preview").attr("src",e),$("#new_student_image").val(e),$("#new_student_image").removeClass("is-invalid"),$("#error_new_student_image").addClass("d-none"),$("#capture_image").text("Re-Capture")})}),$("#new_student_form").submit(function(){let e=$("#new_student_student_number").val(),t=$("#new_student_course").val(),a=$("#new_student_year").val(),n=$("#new_student_section").val(),s=$("#new_student_first_name").val(),d=$("#new_student_middle_name").val(),r=$("#new_student_last_name").val(),u=$("#new_student_date_of_birth").val(),i=$("#new_student_gender").val(),o=$("#new_student_nationality").val(),l=$("#new_student_mobile_number").val().replace(/\D/g,""),c=$("#new_student_email_address").val(),m=$("#new_student_address").val(),p=$("#new_student_image").val(),g=0;if(!p&&($("#new_student_image").addClass("is-invalid"),$("#error_new_student_image").removeClass("d-none"),$("#new_student_image").focus(),g++),11!=l.length&&($("#new_student_mobile_number").addClass("is-invalid"),$("#error_new_student_mobile_number").removeClass("d-none"),$("#new_student_mobile_number").focus(),g++),!g){$("#new_student_submit").text("Please wait..."),$("#new_student_submit").attr("disabled",!0),$(".loading").removeClass("d-none");var v=new FormData;v.append("student_number",e),v.append("course",t),v.append("year",a),v.append("section",n),v.append("first_name",s),v.append("middle_name",d),v.append("last_name",r),v.append("date_of_birth",u),v.append("gender",i),v.append("nationality",o),v.append("mobile_number",l),v.append("email_address",c),v.append("address",m),v.append("image",p),$.ajax({url:"/save_student",data:v,type:"POST",dataType:"JSON",processData:!1,contentType:!1,success:function(e){setTimeout(function(){e?location.reload():($("#new_student_submit").text("Submit"),$("#new_student_submit").removeAttr("disabled"),$(".loading").addClass("d-none"),$("#new_student_student_number").addClass("is-invalid"),$("#error_new_student_student_number").removeClass("d-none"),$("#new_student_student_number").focus())},1500)},error:function(e,e,t){console.error(t)}})}}),$("#new_student_mobile_number").keydown(function(){$("#new_student_mobile_number").removeClass("is-invalid"),$("#error_new_student_mobile_number").addClass("d-none")}),$("#new_student_student_number").keydown(function(){$("#new_student_student_number").removeClass("is-invalid"),$("#error_new_student_student_number").addClass("d-none")}),$(document).on("click",".edit_student",function(){let e=$(this).attr("student_id");$("#update_student_modal").modal("show"),$(".loading").removeClass("d-none");var t=new FormData;t.append("student_id",e),$.ajax({url:"/get_student_data",data:t,type:"POST",dataType:"JSON",processData:!1,contentType:!1,success:function(t){$("#update_student_id").val(e),$("#update_student_student_number").val(t.student_number),$("#update_student_course").val(t.course),$("#update_student_year").val(t.year),$("#update_student_section").val(t.section),$("#update_student_first_name").val(t.first_name),$("#update_student_middle_name").val(t.middle_name),$("#update_student_last_name").val(t.last_name),$("#update_student_date_of_birth").val(t.date_of_birth),$("#update_student_gender").val(t.gender),$("#update_student_nationality").val(t.nationality),$("#update_student_mobile_number").val(t.mobile_number),$("#update_student_email_address").val(t.email_address),$("#update_student_address").val(t.address),$("#update_student_image").val(t.image),$("#update_captured_image_preview").attr("src","static/dist/img/uploads/users/"+t.image),$("#update_student_old_student_number").val(t.student_number),$("#update_student_old_image").val(t.image),$(".loading").addClass("d-none")},error:function(e,e,t){console.error(t)}})}),$("#update_camera_start_stop").click(function(){e?(Webcam.reset(),$("#update_camera_preview").html(""),$(this).text("Start Camera"),$(this).removeClass("btn-danger"),$(this).addClass("btn-primary"),$("#update_capture_image").attr("disabled",!0),$("#update_capture_image").text("Capture"),e=!1):(Webcam.set({height:250,image_format:"jpeg",jpeg_quality:90}),Webcam.attach("#update_camera_preview"),$(this).text("Stop Camera"),$(this).removeClass("btn-primary"),$(this).addClass("btn-danger"),$("#update_capture_image").removeAttr("disabled"),e=!0)}),$("#update_capture_image").click(function(){Webcam.snap(function(e){$("#update_captured_image_preview").attr("src",e),$("#update_student_image").val(e),$("#update_student_image").removeClass("is-invalid"),$("#error_update_student_image").addClass("d-none"),$("#update_capture_image").text("Re-Capture")})}),$("#update_student_form").submit(function(){let e=$("#update_student_student_number").val(),t=$("#update_student_course").val(),a=$("#update_student_year").val(),n=$("#update_student_section").val(),s=$("#update_student_first_name").val(),d=$("#update_student_middle_name").val(),r=$("#update_student_last_name").val(),u=$("#update_student_date_of_birth").val(),i=$("#update_student_gender").val(),o=$("#update_student_nationality").val(),l=$("#update_student_mobile_number").val().replace(/\D/g,""),c=$("#update_student_email_address").val(),m=$("#update_student_address").val(),p=$("#update_student_image").val(),g=$("#update_student_old_student_number").val(),v=$("#update_student_old_image").val(),w=$("#update_student_id").val(),b=0;if(!p&&($("#update_student_image").addClass("is-invalid"),$("#error_update_student_image").removeClass("d-none"),$("#update_student_image").focus(),b++),11!=l.length&&($("#update_student_mobile_number").addClass("is-invalid"),$("#error_update_student_mobile_number").removeClass("d-none"),$("#update_student_mobile_number").focus(),b++),!b){$("#update_student_submit").text("Please wait..."),$("#update_student_submit").attr("disabled",!0),$(".loading").removeClass("d-none");var f=new FormData;f.append("id",w),f.append("student_number",e),f.append("course",t),f.append("year",a),f.append("section",n),f.append("first_name",s),f.append("middle_name",d),f.append("last_name",r),f.append("date_of_birth",u),f.append("gender",i),f.append("nationality",o),f.append("mobile_number",l),f.append("email_address",c),f.append("address",m),f.append("image",p),f.append("old_student_number",g),f.append("old_image",v),$.ajax({url:"/update_student",data:f,type:"POST",dataType:"JSON",processData:!1,contentType:!1,success:function(e){setTimeout(function(){e?location.reload():($("#update_student_submit").text("Submit"),$("#update_student_submit").removeAttr("disabled"),$(".loading").addClass("d-none"),$("#update_student_student_number").addClass("is-invalid"),$("#error_update_student_student_number").removeClass("d-none"),$("#update_student_student_number").focus())},1500)},error:function(e,e,t){console.error(t)}})}}),$("#update_student_mobile_number").keydown(function(){$("#update_student_mobile_number").removeClass("is-invalid"),$("#error_update_student_mobile_number").addClass("d-none")}),$("#update_student_student_number").keydown(function(){$("#update_student_student_number").removeClass("is-invalid"),$("#error_update_student_student_number").addClass("d-none")}),$(document).on("click",".delete_student",function(){let e=$(this).attr("student_id");Swal.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(t=>{if(t.isConfirmed){var a=new FormData;a.append("id",e),$.ajax({url:"/delete_student",data:a,type:"POST",dataType:"JSON",processData:!1,contentType:!1,success:function(e){e&&location.reload()},error:function(e,e,t){console.error(t)}})}})}),$("#new_attendance").click(function(){$(".loading").addClass("d-none"),$("#new_attendance_modal").modal("show")}),$("#new_attendance_start_stop_camera").click(function(){e?(Webcam.reset(),$(this).text("Start Camera"),$(this).removeClass("btn-danger"),$(this).addClass("btn-primary"),$("#new_attendance_capture").attr("disabled",!0),e=!1):(Webcam.set({height:250,image_format:"jpeg",jpeg_quality:90}),Webcam.attach("#new_attendance_camera"),e=!0,$(this).text("Stop Camera"),$(this).removeClass("btn-primary"),$(this).addClass("btn-danger"),$("#new_attendance_capture").removeAttr("disabled"),$("#new_attendance_capture").text("Capture"),e=!0)}),$("#new_attendance_capture").click(function(){Webcam.snap(function(e){$("#new_attendance_image_preview").attr("src",e),$("#new_attendance_image").val(e),$("#actual_results").addClass("d-none"),$("#new_attendance_result").removeClass("d-none"),$("#waiting_message").removeClass("d-none"),$("#waiting_result").removeClass("d-none"),$("#waiting_message").text("Selecting match from the database..."),$("#waiting_message").addClass("text-muted"),$("#waiting_message").removeClass("text-danger"),$("#new_attendance_confirm").addClass("d-none"),$("#new_attendance_capture").text("Re-Capture"),$("#btn_cancel").focus();var t=new FormData;t.append("image",e),$.ajax({url:"/match_face",data:t,type:"POST",dataType:"JSON",processData:!1,contentType:!1,success:function(e){if(e){let t=e.split("_")[0];var a=new FormData;a.append("student_id",t),$.ajax({url:"/get_student_data",data:a,type:"POST",dataType:"JSON",processData:!1,contentType:!1,success:function(e){let t=e.first_name,a=e.middle_name,n=e.last_name,s=a?a.charAt(0)+". ":"";$("#new_attendance_student_number").val(e.student_number),$("#new_attendance_full_name").val(t+" "+s+n),$("#new_attendance_course_year_section").val(e.course+" "+e.year[0]+"-"+e.section),$("#new_attendance_student_image").val(e.image),$("#new_attendance_random_image").attr("src","static/dist/img/uploads/users/"+e.image),$("#waiting_result").addClass("d-none"),$("#actual_results").removeClass("d-none"),$("#new_attendance_confirm").removeClass("d-none"),$("#new_attendance_confirm").focus()},error:function(e,e,t){console.error(t)}})}else $("#waiting_message").text("No registered face detected."),$("#waiting_message").removeClass("text-muted"),$("#waiting_message").addClass("text-danger")},error:function(e,e,t){console.error(t)}})})}),$("#new_attendance_modal").on("hidden.bs.modal",function(){Webcam.reset(),$("#new_attendance_start_stop_camera").text("Start Camera"),$("#new_attendance_start_stop_camera").removeClass("btn-danger"),$("#new_attendance_start_stop_camera").addClass("btn-primary"),$("#new_attendance_capture").attr("disabled",!0),$("#new_attendance_capture").text("Capture"),$("#new_attendance_result").addClass("d-none"),$("#new_attendance_image").val(""),$("#new_attendance_image_preview").attr("src","static/dist/img/white-background.png"),e=!1}),$("#new_attendance_form").submit(function(){let e=$("#new_attendance_student_number").val(),t=$("#new_attendance_full_name").val(),a=$("#new_attendance_course_year_section").val(),n=$("#new_attendance_student_image").val();$("#new_attendance_confirm").text("Please wait..."),$(".loading").removeClass("d-none");var s=new FormData;s.append("student_number",e),s.append("student_name",t),s.append("course_year_section",a),s.append("image",n),$.ajax({url:"/new_attendance",data:s,type:"POST",dataType:"JSON",processData:!1,contentType:!1,success:function(e){e&&location.reload()},error:function(e,e,t){console.error(t)}})})});